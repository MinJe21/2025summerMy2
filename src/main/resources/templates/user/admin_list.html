<!DOCTYPE html>
<html lang="en">

<th:block th:replace="~{/includes/admin/head}" />

<script id="list_info_user" type="text/x-handlebars-template">
    {{#resultData_user}}
    <tr class="gradeA">
        <td>
            <input class="input_chk_delete_user_each" type="checkbox" keyword="{{id}}" id="input_chk_delete_user_each_{{id}}" onclick="listener_chk_delete(this, 'user')" />
        </td>
        <td><font class="font_user_order"></font></td>
        <td><font class="font_user_deleted_{{deleted}} chk_user_deleted_{{id}}">{{deleted}}</font></td>
        <td class="cursor_pointer" onclick="location.href='/user/admin_detail/{{id}}';">{{username}}</td>
        <td class="cursor_pointer" onclick="location.href='/user/admin_detail/{{id}}';">{{name}}</td>
        <td>{{createdAt}} / {{modifiedAt}}
            <div class="hide">
                <input class="input_cursor_user_id" value="{{id}}"/>
                <input class="input_cursor_user_title" value="{{name}}"/>
            </div>
        </td>
    </tr>
    {{/resultData_user}}
</script>
<script type="text/javascript">
    var list_info_user = $("#list_info_user").html();
    var list_info_user_template = Handlebars.compile(list_info_user);
</script>

<body id="page-top">

<!-- Page Wrapper -->
<div id="wrapper">

    <th:block th:replace="~{/includes/admin/sidebar}" />
    <script>
        $(".nav_permission_a").removeClass("collapsed");
        $(".nav_permission_div").addClass("show");
    </script>

    <!-- Content Wrapper -->
    <div id="content-wrapper" class="d-flex flex-column">

        <!-- Main Content -->
        <div id="content">

            <th:block th:replace="~{/includes/admin/topbar}" />

            <!-- Begin Page Content -->
            <div class="container-fluid">

                <!-- Page Heading -->
                <h1 class="h3 mb-2 text-gray-800">사용자 목록</h1>
                <p class="mb-4">전체 목록 조회입니다.</p>

                <div class="mb-4">
                    <input type="hidden" id="input_user_keyword_changed" value="0" />
                    <input type="hidden" id="search_user_callpage" value="" />

                    <div class="form-group row">
                        <label class="col-sm-2 col-form-label">삭제여부</label>
                        <div class="col-sm-4">
                            <select class="select_search_user_keyword form-control mb-2" name="deleted" id="search_user_deleted" onchange="listener_user_keyword_changed()">
                                <option value="" selected="selected">전체</option>
                                <option value="false">일반</option>
                                <option value="true">삭제</option>
                            </select>
                        </div>
                        <label class="col-sm-6 col-form-label"></label>

                        <label class="col-sm-2 col-form-label">등록 시기</label>
                        <div class="col-sm-3">
                            <input class="form-control mb-2" id="search_user_sdate" type="date" onchange="listener_user_keyword_changed()"/>
                        </div>
                        <div class="col-sm-3">
                            <input class="form-control mb-2" id="search_user_fdate" type="date" onchange="listener_user_keyword_changed()"/>
                        </div>
                        <div class="col-sm-4">
                            <button class="btn btn-sm btn-outline-secondary" onclick="set_search_sdatefdate('null', 'user', listener_user_keyword_changed); return false;">초기화</button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="set_search_sdatefdate('today', 'user', listener_user_keyword_changed); return false;">오늘</button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="set_search_sdatefdate('week', 'user', listener_user_keyword_changed); return false;">1주</button>
                            <button class="btn btn-sm btn-outline-secondary" onclick="set_search_sdatefdate('month', 'user', listener_user_keyword_changed); return false;">1개월</button>
                        </div>

                        <label class="col-sm-2 col-form-label">키워드</label>
                        <div class="col-sm-4">
                            <select class="form-control mb-2" id="search_user_keyword" onchange="set_search_keyword('user')">
                                <option value="10" selected="selected">이름</option>
                            </select>
                        </div>
                        <div class="col-sm-6">
                            <input id="search_user_title" onchange="listener_user_keyword_changed();"
                                   class="form-control search_user_keyword_each search_user_keyword_each_10 mb-2" type="text" placeholder="내용을 입력하세요"/>
                        </div>

                        <input type="hidden" id="cursor_user" />
                        <label class="col-sm-2 col-form-label">검색 기준</label>
                        <div class="col-sm-2">
                            <select class="form-control" id="search_user_orderby" onchange="listener_user_keyword_changed();">
                                <option value="id" selected="selected">등록순</option>
                                <option value="name">이름순</option>
                            </select>
                        </div>
                        <label class="col-sm-2 col-form-label">한번에 불러올 갯수</label>
                        <div class="col-sm-2">
                            <select class="form-control" id="search_user_perpage" onchange="listener_user_keyword_changed();">
                                <option value="10" selected="selected">10</option>
                                <option value="50">50</option>
                                <option value="100">100</option>
                            </select>
                        </div>
                        <label class="col-sm-2 col-form-label">조회방향</label>
                        <div class="col-sm-2">
                            <select class="form-control" id="search_user_orderway" onchange="listener_user_keyword_changed();">
                                <option value="DESC" selected="selected">역방향</option>
                                <option value="ASC">정방향</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="w-100">
                    <button class="btn btn-primary mb-2" onclick="location.href='/user/admin_create'; return false;">생성하기</button>
                    <span style="float: right">총 <span class="font_user_total_itemcount">-</span>개</span>
                </div>
                <!-- DataTales Example -->
                <div class="table-responsive">
                    <table class="table table-bordered bg-white" id="dataTable">
                        <thead>
                        <tr>
                            <th>
                                <input class="input_chk_delete_user_all" type="checkbox" keyword="all" id="input_chk_delete_user_all" onclick="listener_chk_delete(this, 'user')" />
                            </th>
                            <th>#</th>
                            <th>삭제여부</th>
                            <th>아이디</th>
                            <th>이름</th>
                            <th>입력일시/수정일시</th>
                        </tr>
                        </thead>
                        <tbody id="tbody_user_list">
                        </tbody>
                    </table>
                    <div class="w-100 m-auto">
                        <button class="btn btn-danger" onclick="delete_user(); return false;">삭제</button>
                        <ul class="pagination" style="float: right" id="ul_user_pagination">
                        </ul>
                    </div>
                </div>

            </div>
            <!-- /.container-fluid -->

        </div>
        <!-- End of Main Content -->

        <th:block th:replace="~{/includes/admin/footer}" />

    </div>
    <!-- End of Content Wrapper -->

</div>
<!-- End of Page Wrapper -->

<th:block th:replace="~{/includes/admin/bottom}" />

<script>
    $( document ).ready(function() {
        console.log( "ready!" );
        search_user();
    });
</script>

<script>
    function listener_user_keyword_changed(){
        $("#input_user_keyword_changed").val("1");
        search_user();
    }
    function listener_user_callpage(obj_num){
        $("#search_user_callpage").val(obj_num);
        search_user();
    }
    function search_user() {
        let search_user_deleted = null;
        if($("#search_user_deleted").val() !== ""){
            search_user_deleted = ($("#search_user_deleted").val() === "true");
        }

        let _data = new Map();
        _data.url = "/api/user/pagedList";
        _data.type = "GET";
        _data.param = {
            perpage : $("#search_user_perpage").val()
            , callpage : $("#search_user_callpage").val()
            , orderby : $("#search_user_orderby").val()
            , orderway : $("#search_user_orderway").val()

            , sdate : $("#search_user_sdate").val()
            , fdate : $("#search_user_fdate").val()

            , deleted : search_user_deleted
            , name : $("#search_user_title").val()
        };
        _data.success = function(obj_data, obj_status, obj_xhr){
            $("#tbody_user_list").html("");
            $("#ul_user_pagination").html("");
            let tempList = obj_data["list"];
            for(let each of tempList){
                let tList = [];
                tList.push(each);
                $("#tbody_user_list").append(list_info_user_template({"resultData_user":tList}));
            }
            listenerAfterPagedList(obj_data, "user");
        }
        _data.error = function(obj_data, obj_status, obj_xhr){
            alert("정상적으로 이루어지지 않았습니다. 다시 시도해주세요.");
        }
        func_ajax(_data);
    }
    function delete_user(){
        if (confirm("정말 삭제하시겠습니까?")) {
        } else {
            alert("취소");
            return false;
        }
        let ids = listenerGetDeleteIds('user');
        let _data = new Map();
        _data.url = "/api/user/list";
        _data.type = "DELETE";
        _data.param = {
            'ids' : ids
        };
        _data.success = function(obj_data, obj_status, obj_xhr){
            search_user();
        }
        _data.error = function(obj_data, obj_status, obj_xhr){
            alert("정상적으로 이루어지지 않았습니다. 다시 시도해주세요.");
        }
        func_ajax(_data);
    }
</script>

</body>

</html>